##能量守恒
一束光源照射到表面上，它有可能被

- 反射
- 折射（散射，透射）
- 吸收（成为热量）

在计算机图形中，一般不考虑光源被吸收的情况，即假设所以进入物体内部的光源最终都会被折射出来。但是金属材质例外，进入物体内部的光源会被全部吸收，因此在实现时对金属和非金属材质需要分别计算处理。
##反射率方程
##BRDF理论模型
求【指定方向上的出射光】和【入射光】的比例的模型。出射光包括反射和折射部分
##Cook-Torrance公式

f(l, v) = (D(h) * F(v, h) * G(l, v, h)) / (4 * (n · l) * (n · v))

计算BRDF反射部分的一种实现，使用到的相关数学公式包括：

- 法线分布函数，D(h)，受粗糙度影响。h 是光源向量 l 和视点向量 v 的半角向量
- 几何衰减函数，G(l, v)，受粗糙度影响
- 菲涅尔方程，F(l, h)，受金属度影响

##法线分布函数 normal distribution function
NDF用于估算【法线方向与半角向量相同的微表面】的占比，有多种NDF接受一个粗糙度，使用统计学方法来估算结果，Trowbridge-Reitz GGX就是其中一种。

D(h) = a<sup>2</sup> / (π * ((n · h)<sup>2</sup> * (a<sup>2</sup> - 1) + 1))<sup>2</sup>

a = Roughness<sup>2</sup>

##几何衰减函数
几何衰减函数用于估算微表面之间互相遮蔽的概率。
##菲涅尔方程

决定某一观察角度下，光源反射部分和折射部分的占比，方程的返回值为Ks，Kd = 1 - Ks。方程的参数包括：

- 视点向量 v
- 半角向量 h（有的网络教程会使用表面法向量n？）
- 物体材质的基础反射率 F_0

菲涅方程计算复杂，可以用来Fresnel-Schlick方程近似。

F_ Schlick(v, h, F_ 0) = F_ 0 + (1 − F_ 0) * (1 − (v · h))<sup>5</sup>

也可以用一些拟合度更低，但性能更好的方程来近似，如Unreal使用的Spherical Gaussian

F (v, h) = F0 + (1 − F0 ) * 2 <sup>(−5.55473(v·h)−6.98316)(v·h)</sup>

菲涅尔方程只适用于非金属材质，但可以通过

